# Deploy via GitHub: push to main → deploy dashboard to Vercel (and optionally gateway).
#
# One-time setup:
# 1. In Vercel: create a project, set Root Directory to "dashboard", add env GATEWAY_URL.
# 2. In GitHub: Settings → Secrets and variables → Actions → add:
#    VERCEL_TOKEN, VERCEL_ORG_ID, VERCEL_PROJECT_ID
#    (Get token from vercel.com/account/tokens; org/project id from project Settings.)
# 3. Gateway: either connect this repo in Railway/Render (they deploy on push), or add
#    RAILWAY_TOKEN + RAILWAY_SERVICE_ID to deploy gateway from this workflow.

name: Deploy

on:
  push:
    branches: [main, master]
  workflow_dispatch:

jobs:
  deploy-dashboard:
    name: Deploy dashboard (Vercel)
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Deploy to Vercel
        uses: amondnet/vercel-action@v25
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
          working-directory: dashboard
          vercel-args: --prod
        if: ${{ secrets.VERCEL_TOKEN != '' && secrets.VERCEL_ORG_ID != '' && secrets.VERCEL_PROJECT_ID != '' }}

      - name: Skip (no Vercel secrets)
        run: |
          echo "Deploy skipped: add VERCEL_TOKEN, VERCEL_ORG_ID, VERCEL_PROJECT_ID in repo Secrets to deploy on push."
          echo "Alternatively, connect this repo in Vercel dashboard — Vercel will build and deploy on every push."
        if: ${{ secrets.VERCEL_TOKEN == '' || secrets.VERCEL_ORG_ID == '' || secrets.VERCEL_PROJECT_ID == '' }}
